<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>ReciclaF치cil - Pontua칞칚o</title>
    <link rel="stylesheet" href="/css/style.css"> </head>
<body>

    <header class="topo">
        <h1 class="titulo-principal"><a href="index.html" class="link-titulo">ReciclaF치cil</a></h1>
        <nav class="menu-superior">
            <a href="perfil.html" class="link-menu">In칤cio</a>
            <a href="registro.html" class="link-menu">Registrar Descarte</a>
            <a href="gamificacao.html" class="link-menu">Pontua칞칚o</a>
            <a href="mapa.html" class="link-menu">Pontos de descarte</a>
            <a href="guia.html" class="link-menu">Guia de descarte</a>
        </nav>
    </header>

    <main class="pontuacao-main">

        <h2 class="titulo-pagina">Minha Pontua칞칚o</h2>

        <div class="painel-pontos">
            <img src="/Imagens/Trofeu.png" alt="Trofeu" class="imagem-trofeu"> <div class="painel-info">
                <p class="painel-texto">Pontos Acumulados</p>
                <p class="painel-pontuacao" id="gamificationPoints">1.304</p> <div class="barra-progresso">
                    <div class="progresso-preenchido" id="gamificationProgressBar" style="width: 65%;"></div> </div>
                <small id="gamificationNextLevelText">Faltam 196 pontos para o Cupom!</small> </div>
        </div>

        <button class="botao-trocar">
            游댃 Trocar
        </button>

        <hr class="separador">

        <h3 class="recompensas-titulo">Recompensas</h3>

        <div class="recompensas-container">
            <button class="recompensa-botao">
                <img src="/Imagens/sacola.png" alt="Sacola" class="imagem-recompensa"> <div class="recompensa-info">
                    <p class="nome-recompensa">Saco de compras reutiliz치vel</p>
                    <p class="custo-recompensa">500 pontos</p>
                </div>
            </button>

            <button class="recompensa-botao">
                <img src="/Imagens/vale.png" alt="Vale" class="imagem-recompensa"> <div class="recompensa-info">
                    <p class="nome-recompensa">Vale-caf칠</p>
                    <p class="custo-recompensa">800 pontos</p>
                </div>
            </button>

            <button class="recompensa-botao">
                <img src="/Imagens/cupom.png" alt="Cupom" class="imagem-recompensa"> <div class="recompensa-info">
                    <p class="nome-recompensa">Cupom de desconto</p>
                    <p class="custo-recompensa">1200 pontos</p>
                </div>
            </button>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const userId = localStorage.getItem('loggedInUserId');
            if (!userId) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch(`http://18.222.5.253:5000/user-data/${userId}`); // URL da API
                const data = await response.json();

                if (response.ok) {
                    const user = data.user;
                    document.getElementById('gamificationPoints').textContent = user.points;
                    
                    const pointsToNextLevel = user.next_level_points - user.points;
                    document.getElementById('gamificationNextLevelText').textContent = `Faltam ${Math.max(0, pointsToNextLevel)} pontos para o pr칩ximo n칤vel!`;
                    
                    const progress = (user.points / user.next_level_points) * 100;
                    document.getElementById('gamificationProgressBar').style.width = `${Math.min(progress, 100)}%`;

                } else {
                    console.error('Erro ao carregar dados do usu치rio:', data.message);
                    alert('Erro ao carregar sua pontua칞칚o. Tente fazer login novamente.');
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Erro na requisi칞칚o para obter dados do usu치rio (pontua칞칚o):', error);
                alert('N칚o foi poss칤vel conectar ao servidor para carregar a pontua칞칚o. Tente novamente.');
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>
